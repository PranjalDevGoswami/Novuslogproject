{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    {% block head %}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %} user table {% endblock %}</title>
   
    <!-- Bootstrap -->
    <link href="{% static 'vendors/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="{% static 'vendors/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">
    <!-- NProgress -->
    <link href="{% static 'vendors/nprogress/nprogress.css' %}" rel="stylesheet">
    <!-- iCheck -->
   <link href="{% static 'vendors/iCheck/skins/flat/green.css' %}" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="{% static 'build/css/custom.min.css' %}" rel="stylesheet">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">


    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    


    {% endblock %}
  </head>

{% block content %}
<style>
  .logo_text {
        font-weight: bold;
        font-size: 18px;


  /* Custom style for the dropdown */
.custom-dropdown {
    position: relative;
    display: inline-block;
}

.custom-dropdown select {
    background-color: #17a2b8;
    color: #fff;
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    cursor: pointer;
}

.custom-dropdown select:focus {
    outline: none;
}

.custom-dropdown label {
    color: #17a2b8;
    margin-right: 10px;
}

.custom-dropdown::after {
    content: '\25BC';
    position: absolute;
    top: 50%;
    right: 5px;
    transform: translateY(-50%);
    pointer-events: none;
}

.custom-dropdown select::-ms-expand {
    display: none;
}


  
    }
</style>
  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view"> 
            <div class="clearfix"></div>
           
            <!-- menu profile quick info -->
            <div class="profile clearfix">
              <div class="profile_pic" style="margin-left: 10px; display: flex; align-items: center;">
                <!-- Logo with text -->
                <img src="{% static 'images/logo.png' %}" alt="Logo" class="img-circle profile_img" style="margin-right: 20px;">
                <span class="logo_text">Novus Insights</span>
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h2>{{name}}</h2>
              </div>
            </div>
            <!-- /menu profile quick info -->
  
            <br />
            
  
            <!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>General</h3>
                <ul class="nav side-menu">
              
                  <li><a><i class="fa fa-edit"></i> User Registration <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                      <li><a href="{% url 'hod_dashboard' %}">Forms</a></li>
                      
                    </ul>
                  </li>
               
                  <li><a><i class="fa fa-table"></i> User Data Tables <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                      <li><a href="{% url 'userhod_data' %}">Tables</a></li>
                      
                    </ul>
                  </li>
                </ul>
              </div>
              
  
            </div>
            <!-- /sidebar menu -->
  
            <!-- /menu footer buttons -->
            <div class="sidebar-footer hidden-small">
          
            </div>
            <!-- /menu footer buttons -->
          </div>
        </div>
  
        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <div class="nav toggle">
              <a id="menu_toggle"><i class="fa fa-bars"></i></a>
            </div>
            <nav class="nav navbar-nav">
              <ul class=" navbar-right">
                <li class="nav-item dropdown open" style="padding-left: 15px;">
                  <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true" id="navbarDropdown" data-toggle="dropdown" aria-expanded="false">
                    {{name}}
                    <!-- <img src="images/img.jpg" alt=""> -->
                  </a>
                  <div class="dropdown-menu dropdown-usermenu pull-right" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="profile"> Profile</a>
                 
                    <a class="dropdown-item" href="{% url 'logout' %}"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
              
                  </div>
                </li>
  
               
              </ul>
            </nav>
          </div>
        </div>
        <!-- /top navigation -->
  
       
        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Respondent Data<small></small></h3>
              </div>


              
              <div class="container-fluid mt-3">
                <div class="row">
                    <!-- Basic Search on the left -->
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" id="basicSearch" placeholder="Search for...">
                        </div>
                    </div>
            
                    <!-- Advance Search on the right -->
                    <div class="col-md-4 text-right">
                        <button class="btn btn-info" id="showAdvancedSearch">Advance Search</button>
                    </div>
                </div>
            
                <!-- Advanced Search Fields -->
                <div class="row mt-3" id="advancedSearchFields" style="display: none;">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="jobTitleInput">Job Title</label>
                            <input type="text" class="form-control" id="jobTitleInput" style="margin-bottom: 100px;">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="countryInput">Country</label>
                            <input type="text" class="form-control" id="countryInput">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="industryInput">Industry</label>
                            <input type="text" class="form-control" id="industryInput">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="actionButton" style="margin-top: 30px;">Action Button</label>&nbsp;
                            <button class="btn btn-primary" id="actionButton">Search</button>
                        </div>
                    </div>
                </div>
            </div>
            
            
            
            <div class="clearfix"></div>
            <div class="btn btn-info simple-link" data-type="self" style="cursor: pointer;">
              <a href="{% url 'userhod_data' %}?type=self" style="color: white; text-decoration: none;">
                  Self Data
              </a>
            </div>
          
            <div class="btn btn-info simple-link" data-type="all" style="cursor: pointer;">
              <a href="{% url 'userhod_data' %}?type=all" style="color: white; text-decoration: none;">
                  Overall Data
              </a>
            </div>

            <div class="row" style="display: block;">

              <div class="clearfix"></div>

              <div class="col-md-12 col-sm-12  ">
                <div class="x_panel">
                
                  <div class="x_content">

                   
                     
                      {% if messages %}
                      <div id="message-container">
                          <ul class="messages">
                              {% for message in messages %}
                              <li class="{{ message.tags }} message-item" style="color:red;">{{ message }}</li>
                              {% endfor %}
                          </ul>
                      </div>
                      {% endif %}
                      <!-- Items Per Page Dropdown on the right -->
                      <div class="col-md-1 text-right">
                        <div class="form-group custom-dropdown">
                            <select id="itemsPerPage" class="form-control" onchange="updateItemsPerPage()">
                                <option value="10" {% if items_per_page == 10 %}selected{% endif %}>10</option>
                                <option value="25" {% if items_per_page == 25 %}selected{% endif %}>25</option>
                                <option value="50" {% if items_per_page == 50 %}selected{% endif %}>50</option>
                                <option value="100" {% if items_per_page == 100 %}selected{% endif %}>100</option>
                                <!-- Add more options as needed -->
                            </select>
                        </div>
                      </div>
                    
                      <div class="table-responsive">
                        <table class="table table-striped jambo_table bulk_action">
                          <thead>
                              <tr class="headings">
                                  <th class="column-title">Sr.No</th>
                                  <th class="column-title">Respondent Name</th>
                                  <th class="column-title">Job Title</th>
                                  <th class="column-title">Country</th>
                                  <th class="column-title">Industry</th>
                                  <th class="column-title">Company</th>
                                  <th class="column-title">Interviewer Name</th>
                                  <th class="column-title">Project</th>
                                  <th class="column-title">Project Type</th>
                                  <th class="column-title">Company Revenue</th>
                                  <th class="column-title">Incentive</th>
                                  <th class="column-title">Interview Duration</th>
                                  <th class="column-title">Interview Date</th>
                                  <th class="column-title">Team Lead</th>
                                  <th class="column-title">Department</th>
                                  <th class="column-title">Status</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for respondent in respondents %}
                              <tr class="even pointer">
                                  <td class=" ">{{ forloop.counter }}</td>
                                  <td class=" ">{{ respondent.name }}</td>
                                  <td class=" ">{{ respondent.job.title }}</td>
                                  <td class=" ">{{ respondent.country.name }}</td>
                                  <td class=" ">{{ respondent.industry.name }}</td>
                                  <td class=" ">{{ respondent.company.name }}</td>
                                  <td class=" ">{{ respondent.analyst.title }}</td>
                                  <td class=" ">{{ respondent.project.name }}</td>
                                  <td class=" ">{{ respondent.project.project_type }}</td>
                                  <td class=" ">{{ respondent.company.revenue }}</td>
                                  <td class=" ">{{ respondent.incentive.Unique_identifier }}</td>
                                  <td class=" ">{{ respondent.project_interview.interview_duration }}</td>
                                  <td class=" ">{{ respondent.project_interview.interview_date }}</td>
                                  <td class=" ">{{ respondent.team_lead }}</td>
                                  <td class=" ">{{ respondent.Department }}</td>
                                  {% if respondent.is_active == 0 %}
                                  <td class="a-right a-right" style="color:red">Pending</td>
                                  {% elif respondent.is_active == 1 %}
                                  <td class="a-right a-right" style="color:green">Complete</td>
                                  {% endif %}
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                    </div>
                    <nav aria-label="Page navigation example">
                      <ul class="pagination">
                          {% if respondents.has_previous %}
                              <li class="page-item"><a class="page-link" href="{{ pagination_url }}1">|<</a></li>
                              <li class="page-item"><a class="page-link" href="{{ pagination_url }}{{ respondents.previous_page_number }}"><<</a></li>
                          {% endif %}
                          {% for pageno in totalpagelist %}
                              <li class="page-item"><a class="page-link" href="{{ pagination_url }}{{ pageno }}">{{ pageno }}</a></li>
                          {% endfor %}
                          {% if respondents.has_next %}
                              <li class="page-item"><a class="page-link" href="{{ pagination_url }}{{ respondents.next_page_number }}">>></a></li>
                              <li class="page-item"><a class="page-link" href="{{ pagination_url }}{{ lastpage }}">>|</a></li>
                          {% endif %}
                      </ul>
                    </nav>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

    {% endblock %}

    {% block scripts %}

    <!-- jQuery -->
    <script src="{% static 'vendors/jquery/dist/jquery.min.js' %}"></script>
    <!-- Bootstrap -->
   <script src="{% static 'vendors/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
    <!-- FastClick -->
    <script src="{% static 'vendors/fastclick/lib/fastclick.js' %}"></script>
    <!-- NProgress -->
    <script src="{% static 'vendors/nprogress/nprogress.js' %}"></script>
    <!-- iCheck -->
    <script src="{% static 'vendors/iCheck/icheck.min.js' %}"></script>

    <!-- Custom Theme Scripts -->
    <script src="{% static 'build/js/custom.min.js' %}"></script>



    <script>
      // Function to update items per page and reload the page
      function updateItemsPerPage() {
          var selectedValue = document.getElementById("itemsPerPage").value;
          var currentUrl = window.location.href;
  
          // Check if the 'items_per_page' parameter already exists in the URL
          if (currentUrl.indexOf('items_per_page=') > -1) {
              // Update the existing value
              var newUrl = currentUrl.replace(/(items_per_page=)[^\&]+/, '$1' + selectedValue);
          } else {
              // Add the 'items_per_page' parameter to the URL
              var separator = currentUrl.indexOf('?') !== -1 ? '&' : '?';
              var newUrl = currentUrl + separator + 'items_per_page=' + selectedValue;
          }
  
          // Reload the page with the updated URL
          window.location.href = newUrl;
      }
    </script>

    <script>
      $(document).ready(function() {
          // Set the timeout to hide messages after 5 seconds (5000 milliseconds)
          setTimeout(function() {
              $('.message-item').fadeOut('slow');
          }, 5000);
      });
  </script>

<!-- Add Bootstrap JS and jQuery links -->
<!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
  $(document).ready(function() {
    // Set the timeout to hide messages after 5 seconds (5000 milliseconds)
    setTimeout(function() {
      $('.message-item').fadeOut('slow');
    }, 5000);



  $(function () {
      $("#industryInput").autocomplete({
          source: "{% url 'autocomplete' %}",
          minLength: 3,
          select: function (event, ui) {
              var terms = this.value.split(','); // Split the current input value by comma
              terms.pop(); // Remove the last element (in case there is an empty string at the end)
              terms.push(ui.item.value); // Add the selected item
              terms.push(''); // Add an empty string and a comma to continue suggestions
              this.value = terms.join(','); // Join the array and set it as the new value
              return false; // Prevent the default behavior
          },
          focus: function () {
              // Prevent value inserted on focus
              return false;
          },
      }).on("keyup", function (event) {
          if (event.keyCode === $.ui.keyCode.COMMA || event.keyCode === $.ui.keyCode.TAB) {
              $(this).autocomplete("search");
          }
      });
  });


  $(function () {
      $("#countryInput").autocomplete({
          source: "{% url 'autocomplete1' %}",
          minLength: 3,
          select: function (event, ui) {
              var terms = this.value.split(','); // Split the current input value by comma
              terms.pop(); // Remove the last element (in case there is an empty string at the end)
              terms.push(ui.item.value); // Add the selected item
              terms.push(''); // Add an empty string and a comma to continue suggestions
              this.value = terms.join(','); // Join the array and set it as the new value
              return false; // Prevent the default behavior
          },
          focus: function () {
              // Prevent value inserted on focus
              return false;
          },
      }).on("keyup", function (event) {
          if (event.keyCode === $.ui.keyCode.COMMA || event.keyCode === $.ui.keyCode.TAB) {
              $(this).autocomplete("search");
          }
      });
  });

  $(function () {
      $("#jobTitleInput").autocomplete({
          source: "{% url 'autocomplete2' %}",
          minLength: 3,
          select: function (event, ui) {
              var terms = this.value.split(','); // Split the current input value by comma
              terms.pop(); // Remove the last element (in case there is an empty string at the end)
              terms.push(ui.item.value); // Add the selected item
              terms.push(''); // Add an empty string and a comma to continue suggestions
              this.value = terms.join(','); // Join the array and set it as the new value
              return false; // Prevent the default behavior
          },
          focus: function () {
              // Prevent value inserted on focus
              return false;
          },
      }).on("keyup", function (event) {
          if (event.keyCode === $.ui.keyCode.COMMA || event.keyCode === $.ui.keyCode.TAB) {
              $(this).autocomplete("search");
          }
      });
  });




    // Function for basic search
    function basicSearch() {
      var searchText = $('#basicSearch').val().toLowerCase();
      filterTableBasic(searchText);
    }

    // Function for advanced search
    function advancedSearch() {
      var jobTitle = $('#jobTitleInput').val().toLowerCase().split(',').map(s => s.trim());
      var country = $('#countryInput').val().toLowerCase().split(',').map(s => s.trim());
      var industry = $('#industryInput').val().toLowerCase().split(',').map(s => s.trim());

      // Combine advanced search conditions
      filterTableAdvanced(jobTitle, country, industry);
    }

    // Function to perform basic filtering
    function filterTableBasic(searchText) {
      // Loop through each row in the table
      $('.jambo_table tbody tr').each(function () {
        // Check if any condition matches for basic search
        var basicSearchMatch = searchText === '' || $(this).text().toLowerCase().includes(searchText);

        // Show or hide the row based on basic search conditions
        if (basicSearchMatch) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    }

    // Function to perform advanced filtering
    function filterTableAdvanced(jobTitle, country, industry) {
      // Loop through each row in the table
      $('.jambo_table tbody tr').each(function () {
        var rowJobTitle = $(this).find('td:eq(2)').text().toLowerCase();
        var rowCountry = $(this).find('td:eq(3)').text().toLowerCase();
        var rowIndustry = $(this).find('td:eq(4)').text().toLowerCase();

        // Check if all conditions match for advanced search
        var advancedSearchMatch =
          (jobTitle.length === 0 || jobTitle.some(title => rowJobTitle.includes(title))) &&
          (country.length === 0 || country.some(c => rowCountry.includes(c))) &&
          (industry.length === 0 || industry.some(ind => rowIndustry.includes(ind)));

        // Show or hide the row based on advanced search conditions
        if (advancedSearchMatch) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    }

    // Basic search input event
    $('#basicSearch').on('input', function() {
      // Trigger the basic search function
      basicSearch();
    });

    // Enter key press event for basic search
    $('#basicSearch').on('keypress', function(event) {
      if (event.which === 13) { // 13 is the code for Enter key
        basicSearch();
      }
    });

    // Action button click event for advanced search
    $('#actionButton').on('click', function() {
      // Trigger the advanced search function
      advancedSearch();
    });

    // Toggle visibility of advanced search fields
    $('#showAdvancedSearch').on('click', function() {
      $('#advancedSearchFields').toggle();
      // If the advanced search fields are hidden, clear their values and trigger basic search
      if ($('#advancedSearchFields').is(':hidden')) {
        $('#jobTitleInput, #countryInput, #industryInput').val('');
        basicSearch();
      }
    });
  });
</script>
</body>
</html>

{% endblock %}